Zilog Z8 Encore! Macro Assembler Version 2.52 (11010702) 20-Oct-16     23:42:45     page:   1


PC     Object              I  Line    Source 
                           A     1    ; Zilog Z8 Encore! ANSI C Compiler Release 3.62
                           A     2    ; -nolocalcse -optsize -nofastcall -const=RAM -
                           A     3    ; -nooptlink -regvar -reduceopt -debug -norevaa
                           A     4    ; -alias 
                           A     5    	DEFINE motor_TEXT,SPACE=ROM
                           A     6    	FILE	"..\..\..\..\DOCUME~1\GITHUB\THIRDY
                           A     7    .debug "C"
                           A     8    	SEGMENT FAR_DATA
000000                     A     9    _RELOAD:
000000 03E8                A    10    	DW	1000
                           A    11    .define "RELOAD"
                           A    12    .alias "_RELOAD"
                           A    13    .class 69
                           A    14    .value _RELOAD
                           A    15    .type 3
                           A    16    .type 0
                           A    17    .endef
                           A    18    	SEGMENT ROM_DATA
                           A    19    
                           A    20    
                           A    21    ;**************************** _motorInit ******
                           A    22    ;Name                         Addr/Register   S
                           A    23    ;_RELOAD                             STATIC    
                           A    24    
                           A    25    
                           A    26    ; Aggregate Stack Size: 0 (words)
                           A    27    
                           A    28    
                           A    29    	.FRAME _n_motorInit,?_n_motorInit,RDATA
                           A    30    	.FRAME _f_motorInit,?_f_motorInit,EDATA
                           A    31    	SEGMENT motor_TEXT
000000                     A    32    _motorInit:
                           A    33    .define "_motorInit"
                           A    34    .value _motorInit
                           A    35    .class 2
                           A    36    .type 65
                           A    37    .type 0
                           A    38    .endef
                           A    39    .begfunc "motorInit",3,"_motorInit"
000000 D6 0000             A    40    	CALL	__b_frameset00
                           A    41    ;    1	#include <motor.h>
                           A    42    ;    2	
                           A    43    ;    3	void motorInit(void){
                           A    44    ;    4		//Setup PWM output ports
                           A    45    ;    5		PADD &= ~(0x02); //ENA for motor 1,
                           A    46    .line 5
000003 E9010FD0            A    47    	LDX	4048,#1
000007 59FD0FD1            A    48    	ANDX	4049,#-3
                           A    49    ;    6		PCDD &= ~(0x80); //ENB for motor 2,
                           A    50    .line 6
00000B E9010FD8            A    51    	LDX	4056,#1
00000F 597F0FD9            A    52    	ANDX	4057,#127
Zilog Z8 Encore! Macro Assembler Version 2.52 (11010702) 20-Oct-16     23:42:45     page:   2


PC     Object              I  Line    Source motor.src
                           A    53    ;    7		PAAF |= (0x02); //turn on Alternate
                           A    54    .line 7
000013 E9020FD0            A    55    	LDX	4048,#2
000017 49020FD1            A    56    	ORX	4049,#2
                           A    57    ;    8		PCAF |= (0x80);
                           A    58    .line 8
00001B E9020FD8            A    59    	LDX	4056,#2
00001F 49800FD9            A    60    	ORX	4057,#128
                           A    61    ;    9	
                           A    62    ;   10		//Setup data direction as output
                           A    63    ;   11		PGDD &= ~(0x02); //IN1A, motor 1 A 
                           A    64    .line 11
000023 E9010FE8            A    65    	LDX	4072,#1
000027 59FD0FE9            A    66    	ANDX	4073,#-3
                           A    67    ;   12		PGDD &= ~(0x01); //IN2A, motor 1 B 
                           A    68    .line 12
00002B E9010FE8            A    69    	LDX	4072,#1
00002F 59FE0FE9            A    70    	ANDX	4073,#-2
                           A    71    ;   13		PGDD &= ~(0x80); //IN1B, motor 2 A 
                           A    72    .line 13
000033 E9010FE8            A    73    	LDX	4072,#1
000037 597F0FE9            A    74    	ANDX	4073,#127
                           A    75    ;   14		PGDD &= ~(0x40); //IN2B, motor 2 B 
                           A    76    .line 14
00003B E9010FE8            A    77    	LDX	4072,#1
00003F 59BF0FE9            A    78    	ANDX	4073,#-65
                           A    79    ;   15	
                           A    80    ;   16		//set Timers to PWM mode, no presca
                           A    81    ;   17		T0CTL1 = 0x83; //PWM_MODE | PRESCAL
                           A    82    .line 17
000043 E9830F07            A    83    	LDX	3847,#131
                           A    84    ;   18		T2CTL1 = 0x83; //PWM_MODE | PRESCAL
                           A    85    .line 18
000047 E9830F17            A    86    	LDX	3863,#131
                           A    87    ;   19		//set reset count value to 0
                           A    88    ;   20		T0H = 0;
                           A    89    .line 20
00004B E9000F00            A    90    	LDX	3840,#-0
                           A    91    ;   21		T0L = 0;
                           A    92    .line 21
00004F E9000F01            A    93    	LDX	3841,#-0
                           A    94    ;   22		T2H = 0;
                           A    95    .line 22
000053 E9000F10            A    96    	LDX	3856,#-0
                           A    97    ;   23		T2L = 0;
                           A    98    .line 23
000057 E9000F11            A    99    	LDX	3857,#-0
                           A   100    ;   24		//set reload value
                           A   101    ;   25		T0RH = (RELOAD >> 8);
                           A   102    .line 25
00005B 841000              A   103    	LDX	R1,_RELOAD
00005E 840001              A   104    	LDX	R0,_RELOAD+1
Zilog Z8 Encore! Macro Assembler Version 2.52 (11010702) 20-Oct-16     23:42:45     page:   3


PC     Object              I  Line    Source motor.src
000061 2C08                A   105    	LD	R2,#8
000063                     A   106    L__0:
000063 D0E1                A   107    	SRA	R1
000065 C0E0                A   108    	RRC	R0
000067 2A FA               A   109    	DJNZ	R2,L__0
000069 940F02              A   110    	LDX	3842,R0
                           A   111    ;   26		T0RL = (RELOAD & 0x00FF);
                           A   112    .line 26
00006C E8 001F03           A   113    	LDX	3843,_RELOAD+1
                           A   114    ;   27		T2RH = (RELOAD >> 8);
                           A   115    .line 27
000070 841000              A   116    	LDX	R1,_RELOAD
000073 840001              A   117    	LDX	R0,_RELOAD+1
000076 2C08                A   118    	LD	R2,#8
000078                     A   119    L__1:
000078 D0E1                A   120    	SRA	R1
00007A C0E0                A   121    	RRC	R0
00007C 2A FA               A   122    	DJNZ	R2,L__1
00007E 940F12              A   123    	LDX	3858,R0
                           A   124    ;   28		T2RL = (RELOAD & 0x00FF);
                           A   125    .line 28
000081 E8 001F13           A   126    	LDX	3859,_RELOAD+1
                           A   127    ;   29		//set PWM duty cycle to 0%
                           A   128    ;   30		T0PWMH = 0;
                           A   129    .line 30
000085 E9000F04            A   130    	LDX	3844,#-0
                           A   131    ;   31		T0PWML = 0;
                           A   132    .line 31
000089 E9000F05            A   133    	LDX	3845,#-0
                           A   134    ;   32		T2PWMH = 0;
                           A   135    .line 32
00008D E9000F14            A   136    	LDX	3860,#-0
                           A   137    ;   33		T2PWML = 0;
                           A   138    .line 33
000091 E9000F15            A   139    	LDX	3861,#-0
                           A   140    ;   34	}
                           A   141    .line 34
000095 D6 0000             A   142    	CALL	__b_framereset
000098 AF                  A   143    	RET	
                           A   144    .endfunc "motorInit",34,"_motorInit"
                           A   145    	SEGMENT ROM_DATA
                           A   146    ;	Jump Table for Switch Statement at line 39
000000                     A   147    L__4:
000000 0004                A   148    	DW	4
000002 0001                A   149    	DW	1
000004 00AF                A   150    	DW	_2_L_1
000006 0002                A   151    	DW	2
000008 00BD                A   152    	DW	_2_L_2
00000A 0003                A   153    	DW	3
00000C 00CB                A   154    	DW	_2_L_3
00000E 0004                A   155    	DW	4
000010 00D9                A   156    	DW	_2_L_4
Zilog Z8 Encore! Macro Assembler Version 2.52 (11010702) 20-Oct-16     23:42:45     page:   4


PC     Object              I  Line    Source motor.src
000012 00DD                A   157    	DW	_2_L_5
                           A   158    
                           A   159    
                           A   160    ;**************************** _motor1Direction 
                           A   161    ;Name                         Addr/Register   S
                           A   162    ;direction                            R15+4    
                           A   163    
                           A   164    
                           A   165    ; Aggregate Stack Size: 0 (words)
                           A   166    
                           A   167    
                           A   168    	.FRAME _n_motor1Direction,?_n_motor1Directi
                           A   169    	.FRAME _f_motor1Direction,?_f_motor1Directi
                           A   170    	SEGMENT motor_TEXT
000099                     A   171    _motor1Direction:
                           A   172    .define "_motor1Direction"
                           A   173    .value _motor1Direction
                           A   174    .class 2
                           A   175    .type 65
                           A   176    .type 0
                           A   177    .endef
                           A   178    .begfunc "motor1Direction",38,"_motor1Direction
                           A   179    .define "direction"
                           A   180    .class 9
                           A   181    .value 4
                           A   182    .type 2
                           A   183    .type 0
                           A   184    .endef
000099 D6 0000             A   185    	CALL	__b_frameset00
                           A   186    ;   35	
                           A   187    ;   36	
                           A   188    ;   37	void motor1Direction(char direction)
                           A   189    ;   38	{
                           A   190    ;   39		switch (direction)
                           A   191    .line 39
00009C 881E04              A   192    	LDX	R1,4(RR14)
00009F E4E1E0              A   193    	LD	R0,R1
0000A2 90E0                A   194    	RL	R0
0000A4 3200                A   195    	SBC	R0,R0
0000A6 2C 00               A   196    	LD	R2,#high(L__4)
0000A8 3C 00               A   197    	LD	R3,#low(L__4)
0000AA D6 0000             A   198    	CALL	__b_ucase
0000AD C4E0                A   199    	JP	@RR0
                           A   200    ;   40		{
                           A   201    ;   41			case MOTOR_FORWARD:
0000AF                     A   202    _2_L_1:
                           A   203    .line 41
                           A   204    ;   42				PGOUT &= ~(0x02); //IN1A se
                           A   205    .line 42
0000AF 59FD0FEB            A   206    	ANDX	4075,#-3
                           A   207    ;   43				PGOUT |= 0x01;    //IN2A se
                           A   208    .line 43
Zilog Z8 Encore! Macro Assembler Version 2.52 (11010702) 20-Oct-16     23:42:45     page:   5


PC     Object              I  Line    Source motor.src
0000B3 49010FEB            A   209    	ORX	4075,#1
                           A   210    ;   44				T0CTL1 |= (1<<7); //enable 
                           A   211    .line 44
0000B7 49800F07            A   212    	ORX	3847,#128
                           A   213    ;   45				break;
                           A   214    .line 45
0000BB 8B 20               A   215    	JR	_2_L_5
                           A   216    ;   46	
                           A   217    ;   47			case MOTOR_BACKWARD:
0000BD                     A   218    _2_L_2:
                           A   219    .line 47
                           A   220    ;   48				PGOUT |= 0x02;	  //IN1A se
                           A   221    .line 48
0000BD 49020FEB            A   222    	ORX	4075,#2
                           A   223    ;   49				PGOUT &= ~(0x01); //IN2A se
                           A   224    .line 49
0000C1 59FE0FEB            A   225    	ANDX	4075,#-2
                           A   226    ;   50				T0CTL1 |= (1<<7); //enable 
                           A   227    .line 50
0000C5 49800F07            A   228    	ORX	3847,#128
                           A   229    ;   51				break;
                           A   230    .line 51
0000C9 8B 12               A   231    	JR	_2_L_5
                           A   232    ;   52	
                           A   233    ;   53			case MOTOR_STOP: //active braki
0000CB                     A   234    _2_L_3:
                           A   235    .line 53
                           A   236    ;   54				PGOUT &= ~(0x02); //IN1A se
                           A   237    .line 54
0000CB 59FD0FEB            A   238    	ANDX	4075,#-3
                           A   239    ;   55				PGOUT &= ~(0x01); //IN2A se
                           A   240    .line 55
0000CF 59FE0FEB            A   241    	ANDX	4075,#-2
                           A   242    ;   56				T0CTL1 |= (1<<7); //enable 
                           A   243    .line 56
0000D3 49800F07            A   244    	ORX	3847,#128
                           A   245    ;   57				break;
                           A   246    .line 57
0000D7 8B 04               A   247    	JR	_2_L_5
                           A   248    ;   58	
                           A   249    ;   59			case MOTOR_DRIFT: //passive bra
0000D9                     A   250    _2_L_4:
                           A   251    .line 59
                           A   252    ;   60				T0CTL1 &= ~(1<<7); //disabl
                           A   253    .line 60
0000D9 597F0F07            A   254    	ANDX	3847,#127
                           A   255    ;   61				break;
                           A   256    ;   62		}
                           A   257    ;   63	}
0000DD                     A   258    _2_L_5:
                           A   259    .line 63
0000DD D6 0000             A   260    	CALL	__b_framereset
Zilog Z8 Encore! Macro Assembler Version 2.52 (11010702) 20-Oct-16     23:42:45     page:   6


PC     Object              I  Line    Source motor.src
0000E0 AF                  A   261    	RET	
                           A   262    .endfunc "motor1Direction",63,"_motor1Direction
                           A   263    	SEGMENT ROM_DATA
                           A   264    ;	Jump Table for Switch Statement at line 66
000014                     A   265    L__7:
000014 0004                A   266    	DW	4
000016 0001                A   267    	DW	1
000018 00F7                A   268    	DW	_3_L_6
00001A 0002                A   269    	DW	2
00001C 0105                A   270    	DW	_3_L_7
00001E 0003                A   271    	DW	3
000020 0113                A   272    	DW	_3_L_8
000022 0004                A   273    	DW	4
000024 0121                A   274    	DW	_3_L_9
000026 0125                A   275    	DW	_3_L_10
                           A   276    
                           A   277    
                           A   278    ;**************************** _motor2Direction 
                           A   279    ;Name                         Addr/Register   S
                           A   280    ;direction                            R15+4    
                           A   281    
                           A   282    
                           A   283    ; Aggregate Stack Size: 0 (words)
                           A   284    
                           A   285    
                           A   286    	.FRAME _n_motor2Direction,?_n_motor2Directi
                           A   287    	.FRAME _f_motor2Direction,?_f_motor2Directi
                           A   288    	SEGMENT motor_TEXT
0000E1                     A   289    _motor2Direction:
                           A   290    .define "_motor2Direction"
                           A   291    .value _motor2Direction
                           A   292    .class 2
                           A   293    .type 65
                           A   294    .type 0
                           A   295    .endef
                           A   296    .begfunc "motor2Direction",65,"_motor2Direction
                           A   297    .define "direction"
                           A   298    .class 9
                           A   299    .value 4
                           A   300    .type 2
                           A   301    .type 0
                           A   302    .endef
0000E1 D6 0000             A   303    	CALL	__b_frameset00
                           A   304    ;   64	
                           A   305    ;   65	void motor2Direction(char direction){
                           A   306    ;   66		switch (direction){
                           A   307    .line 66
0000E4 881E04              A   308    	LDX	R1,4(RR14)
0000E7 E4E1E0              A   309    	LD	R0,R1
0000EA 90E0                A   310    	RL	R0
0000EC 3200                A   311    	SBC	R0,R0
0000EE 2C 00               A   312    	LD	R2,#high(L__7)
Zilog Z8 Encore! Macro Assembler Version 2.52 (11010702) 20-Oct-16     23:42:45     page:   7


PC     Object              I  Line    Source motor.src
0000F0 3C 14               A   313    	LD	R3,#low(L__7)
0000F2 D6 0000             A   314    	CALL	__b_ucase
0000F5 C4E0                A   315    	JP	@RR0
                           A   316    ;   67			case MOTOR_FORWARD:
0000F7                     A   317    _3_L_6:
                           A   318    .line 67
                           A   319    ;   68				PGOUT |= 0x80; //IN1B set t
                           A   320    .line 68
0000F7 49800FEB            A   321    	ORX	4075,#128
                           A   322    ;   69				PGOUT &= ~(0x40);  //IN2B s
                           A   323    .line 69
0000FB 59BF0FEB            A   324    	ANDX	4075,#-65
                           A   325    ;   70				T2CTL1 |= (1<<7); //enable 
                           A   326    .line 70
0000FF 49800F17            A   327    	ORX	3863,#128
                           A   328    ;   71				break;
                           A   329    .line 71
000103 8B 20               A   330    	JR	_3_L_10
                           A   331    ;   72	
                           A   332    ;   73			case MOTOR_BACKWARD:
000105                     A   333    _3_L_7:
                           A   334    .line 73
                           A   335    ;   74				PGOUT &= ~(0x80);//IN1B set
                           A   336    .line 74
000105 597F0FEB            A   337    	ANDX	4075,#127
                           A   338    ;   75				PGOUT |= 0x40; 	//IN2B set 
                           A   339    .line 75
000109 49400FEB            A   340    	ORX	4075,#64
                           A   341    ;   76				T2CTL1 |= (1<<7); //enable 
                           A   342    .line 76
00010D 49800F17            A   343    	ORX	3863,#128
                           A   344    ;   77				break;
                           A   345    .line 77
000111 8B 12               A   346    	JR	_3_L_10
                           A   347    ;   78	
                           A   348    ;   79			case MOTOR_STOP: //active braki
000113                     A   349    _3_L_8:
                           A   350    .line 79
                           A   351    ;   80				PGOUT &= ~(0x80); //IN1A se
                           A   352    .line 80
000113 597F0FEB            A   353    	ANDX	4075,#127
                           A   354    ;   81				PGOUT &= ~(0x40); //IN2A se
                           A   355    .line 81
000117 59BF0FEB            A   356    	ANDX	4075,#-65
                           A   357    ;   82				T2CTL1 |= (1<<7); //enable 
                           A   358    .line 82
00011B 49800F17            A   359    	ORX	3863,#128
                           A   360    ;   83				break;
                           A   361    .line 83
00011F 8B 04               A   362    	JR	_3_L_10
                           A   363    ;   84	
                           A   364    ;   85			case MOTOR_DRIFT: //passive bra
Zilog Z8 Encore! Macro Assembler Version 2.52 (11010702) 20-Oct-16     23:42:45     page:   8


PC     Object              I  Line    Source motor.src
000121                     A   365    _3_L_9:
                           A   366    .line 85
                           A   367    ;   86				T2CTL1 &= ~(1<<7); //disabl
                           A   368    .line 86
000121 597F0F17            A   369    	ANDX	3863,#127
                           A   370    ;   87				break;
                           A   371    ;   88		}
                           A   372    ;   89	}
000125                     A   373    _3_L_10:
                           A   374    .line 89
000125 D6 0000             A   375    	CALL	__b_framereset
000128 AF                  A   376    	RET	
                           A   377    .endfunc "motor2Direction",89,"_motor2Direction
                           A   378    	SEGMENT ROM_DATA
                           A   379    
                           A   380    
                           A   381    ;**************************** _motor1Speed ****
                           A   382    ;Name                         Addr/Register   S
                           A   383    ;_RELOAD                             STATIC    
                           A   384    ;s                                      RR0    
                           A   385    
                           A   386    
                           A   387    ; Aggregate Stack Size: 0 (words)
                           A   388    
                           A   389    
                           A   390    	.FRAME _n_motor1Speed,?_n_motor1Speed,RDATA
                           A   391    	.FRAME _f_motor1Speed,?_f_motor1Speed,EDATA
                           A   392    	SEGMENT motor_TEXT
000129                     A   393    _motor1Speed:
                           A   394    .define "_motor1Speed"
                           A   395    .value _motor1Speed
                           A   396    .class 2
                           A   397    .type 65
                           A   398    .type 0
                           A   399    .endef
                           A   400    .begfunc "motor1Speed",91,"_motor1Speed"
                           A   401    .define "s"
                           A   402    .class 17
                           A   403    .reg 17
                           A   404    .type 3
                           A   405    .type 0
                           A   406    .endef
000129 D6 0000             A   407    	CALL	__b_frameset00
00012C 880E04              A   408    	LDX	R0,4(RR14)
00012F 881E05              A   409    	LDX	R1,5(RR14)
                           A   410    ;   90	
                           A   411    ;   91	void motor1Speed(int s){
                           A   412    ;   92		if (s>=RELOAD){
                           A   413    .line 92
000132 A8 001EE1           A   414    	CPX	R1,_RELOAD+1
000136 1FA8 000EE0         A   415    	CPCX	R0,_RELOAD
00013B 1B 08               A   416    	JR	LT,_4_L_12
Zilog Z8 Encore! Macro Assembler Version 2.52 (11010702) 20-Oct-16     23:42:45     page:   9


PC     Object              I  Line    Source motor.src
                           A   417    ;   93			s = RELOAD-1;
                           A   418    .line 93
00013D 840000              A   419    	LDX	R0,_RELOAD
000140 841001              A   420    	LDX	R1,_RELOAD+1
000143 80E0                A   421    	DECW	RR0
                           A   422    ;   94		}
000145                     A   423    _4_L_12:
                           A   424    .line 94
                           A   425    ;   95		s = RELOAD - s;
                           A   426    .line 95
000145 843000              A   427    	LDX	R3,_RELOAD
000148 842001              A   428    	LDX	R2,_RELOAD+1
00014B 2221                A   429    	SUB	R2,R1
00014D 3230                A   430    	SBC	R3,R0
00014F E4E3E0              A   431    	LD	R0,R3
000152 E4E2E1              A   432    	LD	R1,R2
                           A   433    ;   96		T0PWMH = (s >> 8);
                           A   434    .line 96
000155 0C08                A   435    	LD	R0,#8
000157                     A   436    L__11:
000157 D0E3                A   437    	SRA	R3
000159 C0E2                A   438    	RRC	R2
00015B 0A FA               A   439    	DJNZ	R0,L__11
00015D 942F04              A   440    	LDX	3844,R2
                           A   441    ;   97		T0PWML = (s & 0x00FF);
                           A   442    .line 97
000160 941F05              A   443    	LDX	3845,R1
                           A   444    ;   98	}
                           A   445    .line 98
000163 D6 0000             A   446    	CALL	__b_framereset
000166 AF                  A   447    	RET	
                           A   448    .endfunc "motor1Speed",98,"_motor1Speed"
                           A   449    	SEGMENT ROM_DATA
                           A   450    
                           A   451    
                           A   452    ;**************************** _motor2Speed ****
                           A   453    ;Name                         Addr/Register   S
                           A   454    ;_RELOAD                             STATIC    
                           A   455    ;s                                      RR0    
                           A   456    
                           A   457    
                           A   458    ; Aggregate Stack Size: 0 (words)
                           A   459    
                           A   460    
                           A   461    	.FRAME _n_motor2Speed,?_n_motor2Speed,RDATA
                           A   462    	.FRAME _f_motor2Speed,?_f_motor2Speed,EDATA
                           A   463    	SEGMENT motor_TEXT
000167                     A   464    _motor2Speed:
                           A   465    .define "_motor2Speed"
                           A   466    .value _motor2Speed
                           A   467    .class 2
                           A   468    .type 65
Zilog Z8 Encore! Macro Assembler Version 2.52 (11010702) 20-Oct-16     23:42:45     page:  10


PC     Object              I  Line    Source motor.src
                           A   469    .type 0
                           A   470    .endef
                           A   471    .begfunc "motor2Speed",100,"_motor2Speed"
                           A   472    .define "s"
                           A   473    .class 17
                           A   474    .reg 17
                           A   475    .type 3
                           A   476    .type 0
                           A   477    .endef
000167 D6 0000             A   478    	CALL	__b_frameset00
00016A 880E04              A   479    	LDX	R0,4(RR14)
00016D 881E05              A   480    	LDX	R1,5(RR14)
                           A   481    ;   99	
                           A   482    ;  100	void motor2Speed(int s){
                           A   483    ;  101		if (s>=RELOAD){
                           A   484    .line 101
000170 A8 001EE1           A   485    	CPX	R1,_RELOAD+1
000174 1FA8 000EE0         A   486    	CPCX	R0,_RELOAD
000179 1B 08               A   487    	JR	LT,_5_L_15
                           A   488    ;  102			s = RELOAD-1;
                           A   489    .line 102
00017B 840000              A   490    	LDX	R0,_RELOAD
00017E 841001              A   491    	LDX	R1,_RELOAD+1
000181 80E0                A   492    	DECW	RR0
                           A   493    ;  103		}
000183                     A   494    _5_L_15:
                           A   495    .line 103
                           A   496    ;  104		s = RELOAD - s;
                           A   497    .line 104
000183 843000              A   498    	LDX	R3,_RELOAD
000186 842001              A   499    	LDX	R2,_RELOAD+1
000189 2221                A   500    	SUB	R2,R1
00018B 3230                A   501    	SBC	R3,R0
00018D E4E3E0              A   502    	LD	R0,R3
000190 E4E2E1              A   503    	LD	R1,R2
                           A   504    ;  105		T2PWMH = (s >> 8);
                           A   505    .line 105
000193 0C08                A   506    	LD	R0,#8
000195                     A   507    L__15:
000195 D0E3                A   508    	SRA	R3
000197 C0E2                A   509    	RRC	R2
000199 0A FA               A   510    	DJNZ	R0,L__15
00019B 942F14              A   511    	LDX	3860,R2
                           A   512    ;  106		T2PWML = (s & 0x00FF);
                           A   513    .line 106
00019E 941F15              A   514    	LDX	3861,R1
                           A   515    ;  107	}
                           A   516    .line 107
0001A1 D6 0000             A   517    	CALL	__b_framereset
0001A4 AF                  A   518    	RET	
                           A   519    .endfunc "motor2Speed",107,"_motor2Speed"
                           A   520    	SEGMENT ROM_DATA
Zilog Z8 Encore! Macro Assembler Version 2.52 (11010702) 20-Oct-16     23:42:45     page:  11


PC     Object              I  Line    Source motor.src
                           A   521    
                           A   522    
                           A   523    ;**************************** _motorsSet ******
                           A   524    ;Name                         Addr/Register   S
                           A   525    ;_motor1Speed                        IMPORT  --
                           A   526    ;_motor2Speed                        IMPORT  --
                           A   527    ;_motor2Direction                    IMPORT  --
                           A   528    ;_motor1Direction                    IMPORT  --
                           A   529    ;m2                                     RR0    
                           A   530    ;m1                                     RR2    
                           A   531    ;offsetR                             R15+10    
                           A   532    ;offsetL                              R15+8    
                           A   533    ;r                                    R15+6    
                           A   534    ;t                                    R15+4    
                           A   535    
                           A   536    
                           A   537    ; Aggregate Stack Size: -4 (words)
                           A   538    
                           A   539    
                           A   540    	.FRAME _n_motorsSet,?_n_motorsSet,RDATA
                           A   541    	.FCALL _n_motor1Direction
                           A   542    	.FCALL _n_motor2Direction
                           A   543    	.FCALL _n_motor2Speed
                           A   544    	.FCALL _n_motor1Speed
                           A   545    	.FRAME _f_motorsSet,?_f_motorsSet,EDATA
                           A   546    	.FCALL _f_motor1Direction
                           A   547    	.FCALL _f_motor2Direction
                           A   548    	.FCALL _f_motor2Speed
                           A   549    	.FCALL _f_motor1Speed
                           A   550    	SEGMENT motor_TEXT
0001A5                     A   551    _motorsSet:
                           A   552    .define "_motorsSet"
                           A   553    .value _motorsSet
                           A   554    .class 2
                           A   555    .type 65
                           A   556    .type 0
                           A   557    .endef
                           A   558    .begfunc "motorsSet",109,"_motorsSet"
                           A   559    .define "t"
                           A   560    .class 17
                           A   561    .reg -1
                           A   562    .type 3
                           A   563    .type 0
                           A   564    .endef
                           A   565    .define "r"
                           A   566    .class 9
                           A   567    .value 6
                           A   568    .type 3
                           A   569    .type 0
                           A   570    .endef
                           A   571    .define "offsetL"
                           A   572    .class 9
Zilog Z8 Encore! Macro Assembler Version 2.52 (11010702) 20-Oct-16     23:42:45     page:  12


PC     Object              I  Line    Source motor.src
                           A   573    .value 8
                           A   574    .type 3
                           A   575    .type 0
                           A   576    .endef
                           A   577    .define "offsetR"
                           A   578    .class 9
                           A   579    .value 10
                           A   580    .type 3
                           A   581    .type 0
                           A   582    .endef
                           A   583    ;  108	
                           A   584    ;  109	void motorsSet(signed int t, int r, int
                           A   585    .define "U‹ìjÿh0/J"
                           A   586    .class 4
                           A   587    .reg 18
                           A   588    .type 3
                           A   589    .type 0
                           A   590    .endef
                           A   591    .define "U‹ìjÿh0/J"
                           A   592    .class 4
                           A   593    .reg 17
                           A   594    .type 3
                           A   595    .type 0
                           A   596    .endef
0001A5 5C04                A   597    	LD	R5,#4
0001A7 D6 0000             A   598    	CALL	__b_frameset0
                           A   599    ;  110		int m1;
                           A   600    ;  111		int m2;
                           A   601    ;  112		m1 = t + r;
                           A   602    .line 112
0001AA 880E06              A   603    	LDX	R0,6(RR14)
0001AD 881E07              A   604    	LDX	R1,7(RR14)
0001B0 882E04              A   605    	LDX	R2,4(RR14)
0001B3 883E05              A   606    	LDX	R3,5(RR14)
0001B6 0231                A   607    	ADD	R3,R1
0001B8 1220                A   608    	ADC	R2,R0
                           A   609    ;  113		m2 = t - r;
                           A   610    .line 113
0001BA 884E06              A   611    	LDX	R4,6(RR14)
0001BD 885E07              A   612    	LDX	R5,7(RR14)
0001C0 880E04              A   613    	LDX	R0,4(RR14)
0001C3 881E05              A   614    	LDX	R1,5(RR14)
0001C6 2215                A   615    	SUB	R1,R5
0001C8 3204                A   616    	SBC	R0,R4
                           A   617    ;  114		if(t==0){
                           A   618    .line 114
0001CA 884E04              A   619    	LDX	R4,4(RR14)
0001CD 885E05              A   620    	LDX	R5,5(RR14)
0001D0 4245                A   621    	OR	R4,R5
0001D2 EB 2B               A   622    	JR	NE,_6_L_24
                           A   623    ;  115			motor1Direction(MOTOR_STOP);
                           A   624    .line 115
Zilog Z8 Encore! Macro Assembler Version 2.52 (11010702) 20-Oct-16     23:42:45     page:  13


PC     Object              I  Line    Source motor.src
0001D4 1F7003              A   625    	PUSH	#3
0001D7 89E0FF              A   626    	LDX	-1(RR14),R0
0001DA 89E1FE              A   627    	LDX	-2(RR14),R1
0001DD 89E2FD              A   628    	LDX	-3(RR14),R2
0001E0 89E3FC              A   629    	LDX	-4(RR14),R3
0001E3 D6 0099             A   630    	CALL	_motor1Direction
0001E6 50E4                A   631    	POP	R4
                           A   632    ;  116			motor2Direction(MOTOR_STOP);
                           A   633    .line 116
0001E8 1F7003              A   634    	PUSH	#3
0001EB D6 00E1             A   635    	CALL	_motor2Direction
0001EE 883EFC              A   636    	LDX	R3,-4(RR14)
0001F1 882EFD              A   637    	LDX	R2,-3(RR14)
0001F4 881EFE              A   638    	LDX	R1,-2(RR14)
0001F7 880EFF              A   639    	LDX	R0,-1(RR14)
0001FA 50E4                A   640    	POP	R4
                           A   641    ;  117		} else {
                           A   642    .line 117
0001FC 8D 02 C7            A   643    	JR	_6_L_25
0001FF                     A   644    _6_L_24:
                           A   645    ;  118		if(m2 > 0)
                           A   646    .line 118
0001FF A6E100              A   647    	CP	R1,#0
000202 1FA6E000            A   648    	CPC	R0,#-0
000206 2B 22               A   649    	JR	LE,_6_L_18
                           A   650    ;  119		{
                           A   651    ;  120			motor2Direction(MOTOR_BACKWARD)
                           A   652    .line 120
000208 1F7002              A   653    	PUSH	#2
00020B 89E0FF              A   654    	LDX	-1(RR14),R0
00020E 89E1FE              A   655    	LDX	-2(RR14),R1
000211 89E2FD              A   656    	LDX	-3(RR14),R2
000214 89E3FC              A   657    	LDX	-4(RR14),R3
000217 D6 00E1             A   658    	CALL	_motor2Direction
00021A 883EFC              A   659    	LDX	R3,-4(RR14)
00021D 882EFD              A   660    	LDX	R2,-3(RR14)
000220 881EFE              A   661    	LDX	R1,-2(RR14)
000223 880EFF              A   662    	LDX	R0,-1(RR14)
000226 50E4                A   663    	POP	R4
                           A   664    ;  121		}
                           A   665    ;  122		else
                           A   666    .line 122
000228 8B 2A               A   667    	JR	_6_L_21
00022A                     A   668    _6_L_18:
                           A   669    ;  123		{
                           A   670    ;  124			m2 = - m2;
                           A   671    .line 124
00022A 60E0                A   672    	COM	R0
00022C 60E1                A   673    	COM	R1
00022E 1FE8EE0E E4         A   674    	LDWX	RR4,RR0
000233 A0E4                A   675    	INCW	RR4
000235 1FE8EE4E E0         A   676    	LDWX	RR0,RR4
Zilog Z8 Encore! Macro Assembler Version 2.52 (11010702) 20-Oct-16     23:42:45     page:  14


PC     Object              I  Line    Source motor.src
                           A   677    ;  125			motor2Direction(MOTOR_FORWARD);
                           A   678    .line 125
00023A 1F7001              A   679    	PUSH	#1
00023D 89E0FF              A   680    	LDX	-1(RR14),R0
000240 89E1FE              A   681    	LDX	-2(RR14),R1
000243 89E2FD              A   682    	LDX	-3(RR14),R2
000246 89E3FC              A   683    	LDX	-4(RR14),R3
000249 D6 00E1             A   684    	CALL	_motor2Direction
00024C 883EFC              A   685    	LDX	R3,-4(RR14)
00024F 882EFD              A   686    	LDX	R2,-3(RR14)
000252 50E4                A   687    	POP	R4
                           A   688    ;  126		}
000254                     A   689    _6_L_21:
                           A   690    .line 126
                           A   691    ;  127		if(m1 > 0)
                           A   692    .line 127
000254 A6E300              A   693    	CP	R3,#0
000257 1FA6E200            A   694    	CPC	R2,#-0
00025B 2B 16               A   695    	JR	LE,_6_L_20
                           A   696    ;  128		{
                           A   697    ;  129			motor1Direction(MOTOR_BACKWARD)
                           A   698    .line 129
00025D 1F7002              A   699    	PUSH	#2
000260 D6 0099             A   700    	CALL	_motor1Direction
000263 883EFC              A   701    	LDX	R3,-4(RR14)
000266 882EFD              A   702    	LDX	R2,-3(RR14)
000269 881EFE              A   703    	LDX	R1,-2(RR14)
00026C 880EFF              A   704    	LDX	R0,-1(RR14)
00026F 50E4                A   705    	POP	R4
                           A   706    ;  130		}
                           A   707    ;  131		else
                           A   708    .line 131
000271 8B 24               A   709    	JR	_6_L_22
000273                     A   710    _6_L_20:
                           A   711    ;  132		{
                           A   712    ;  133			m1 = - m1;
                           A   713    .line 133
000273 60E2                A   714    	COM	R2
000275 60E3                A   715    	COM	R3
000277 1FE8EE2E E4         A   716    	LDWX	RR4,RR2
00027C A0E4                A   717    	INCW	RR4
00027E 1FE8EE4E E2         A   718    	LDWX	RR2,RR4
                           A   719    ;  134			motor1Direction(MOTOR_FORWARD);
                           A   720    .line 134
000283 1F7001              A   721    	PUSH	#1
000286 89E2FD              A   722    	LDX	-3(RR14),R2
000289 89E3FC              A   723    	LDX	-4(RR14),R3
00028C D6 0099             A   724    	CALL	_motor1Direction
00028F 881EFE              A   725    	LDX	R1,-2(RR14)
000292 880EFF              A   726    	LDX	R0,-1(RR14)
000295 50E4                A   727    	POP	R4
                           A   728    ;  135		}
Zilog Z8 Encore! Macro Assembler Version 2.52 (11010702) 20-Oct-16     23:42:45     page:  15


PC     Object              I  Line    Source motor.src
000297                     A   729    _6_L_22:
                           A   730    .line 135
                           A   731    ;  136		motor2Speed(m2+offsetL);
                           A   732    .line 136
000297 885E08              A   733    	LDX	R5,8(RR14)
00029A 884E09              A   734    	LDX	R4,9(RR14)
00029D 0241                A   735    	ADD	R4,R1
00029F 1250                A   736    	ADC	R5,R0
0002A1 70E4                A   737    	PUSH	R4
0002A3 70E5                A   738    	PUSH	R5
0002A5 D6 0167             A   739    	CALL	_motor2Speed
0002A8 883EFC              A   740    	LDX	R3,-4(RR14)
0002AB 882EFD              A   741    	LDX	R2,-3(RR14)
0002AE 50E0                A   742    	POP	R0
0002B0 50E0                A   743    	POP	R0
                           A   744    ;  137		motor1Speed(m1+offsetR);
                           A   745    .line 137
0002B2 881E0A              A   746    	LDX	R1,10(RR14)
0002B5 880E0B              A   747    	LDX	R0,11(RR14)
0002B8 0203                A   748    	ADD	R0,R3
0002BA 1212                A   749    	ADC	R1,R2
0002BC 70E0                A   750    	PUSH	R0
0002BE 70E1                A   751    	PUSH	R1
0002C0 D6 0129             A   752    	CALL	_motor1Speed
0002C3 50E0                A   753    	POP	R0
0002C5 50E0                A   754    	POP	R0
                           A   755    ;  138		}
                           A   756    ;  139	}
0002C7                     A   757    _6_L_25:
                           A   758    .line 139
0002C7 D6 0000             A   759    	CALL	__b_framereset
0002CA AF                  A   760    	RET	
                           A   761    .endfunc "motorsSet",139,"_motorsSet"
                           A   762    	XREF __b_ucase:ROM
                           A   763    	XREF __b_framereset:ROM
                           A   764    	XREF __b_frameset0:ROM
                           A   765    	XREF __b_frameset00:ROM
                           A   766    	XDEF _motorsSet
                           A   767    	XDEF _motor2Speed
                           A   768    	XDEF _motor1Speed
                           A   769    	XDEF _motor2Direction
                           A   770    	XDEF _motor1Direction
                           A   771    	XDEF _motorInit
                           A   772    	XDEF _RELOAD
                           A   773    	END


Errors: 0
Warnings: 0
Lines Assembled: 774
